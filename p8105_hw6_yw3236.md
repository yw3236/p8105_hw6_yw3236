p8105\_hw6\_yw3236
================
Yishan Wang
2018-11-19

Problem 1
=========

``` r
homicides_data = read.csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")
```

``` r
new_homicides_data = homicides_data %>%
  mutate(city_state = paste(city, state, sep = ", ")) %>%
  mutate(resolved = as.numeric(disposition == "Closed by arrest")) %>% #factor???
  filter(city_state != "Dallas, TX" & city_state != "Phoenix, AZ" & city_state != "Kansas City, MO") %>%
  filter(city_state != "Tulsa, AL") %>%
  mutate(victim_race = ifelse(victim_race == "White", "white", "non-white"),
         victim_race = fct_relevel(victim_race, "white"),
         victim_age = as.numeric(victim_age))
```

View(new\_homicides\_data)

``` r
fit_logistic = new_homicides_data %>%
  filter(city_state == "Baltimore, MD") %>%
  glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 
```

``` r
fit_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         CI_lower = exp(estimate - qnorm(0.975) * std.error),
         CI_upper = exp(estimate + qnorm(0.975) * std.error)) %>%
  select(term, OR, CI_lower, CI_upper, p.value) %>% 
  filter(term == "victim_racenon-white") %>%
  knitr::kable(digits = 3)
```

| term                  |     OR|  CI\_lower|  CI\_upper|  p.value|
|:----------------------|------:|----------:|----------:|--------:|
| victim\_racenon-white |  0.453|      0.322|      0.637|        0|

``` r
glm_function = function(city_data){
  
  city_data %>%
    nest(-city_state) %>%  #nest first
    mutate(glm = purrr::map(data, ~glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())),
           tidied = purrr::map(glm, broom::tidy)) %>%  #apply test
    unnest(tidied, .drop = TRUE) %>%  #unnest
    mutate(OR = exp(estimate),
           CI_lower = exp(estimate - qnorm(0.975) * std.error),
           CI_upper = exp(estimate + qnorm(0.975) * std.error)) %>%
    filter(term == "victim_racenon-white") %>%
    select(city_state, OR, CI_lower, CI_upper, p.value) %>%
    data.frame()
  
}
```

``` r
multicity_glm = glm_function(new_homicides_data)
```

``` r
multicity_glm %>%
  ggplot() +
  geom_point(aes(x = reorder(city_state, OR), y = OR)) +  #order cities by the value of estimates
  geom_errorbar(aes(x = reorder(city_state, OR), ymin = CI_lower, ymax = CI_upper, OR)) +  #add error bar
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = rel(1))) +
  labs(x = "City", y = "OR for Comparing Non-white Victims to White Victims with 95% CI")
```

    ## Warning: Ignoring unknown aesthetics: y

![](p8105_hw6_yw3236_files/figure-markdown_github/unnamed-chunk-8-1.png)

Problem 2
=========

``` r
birthweight_data = read.csv("./data/birthweight.csv") %>%
  janitor::clean_names() %>%
  mutate(mrace = factor(mrace, levels = c("1", "2", "3", "4", "8")),
         malform = factor(malform, levels = c("0", "1")),
         frace = factor(frace, levels = c("1", "2", "3", "4", "8", "9")),
         babysex = factor(babysex, levels = c("1", "2")))

sapply(birthweight_data, function(x)sum(is.na(x)))
```

    ##  babysex    bhead  blength      bwt    delwt  fincome    frace  gaweeks 
    ##        0        0        0        0        0        0        0        0 
    ##  malform menarche  mheight   momage    mrace   parity  pnumlbw  pnumsga 
    ##        0        0        0        0        0        0        0        0 
    ##    ppbmi     ppwt   smoken   wtgain 
    ##        0        0        0        0

View(birthweight\_data)
