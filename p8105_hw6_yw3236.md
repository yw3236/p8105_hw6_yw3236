p8105\_hw6\_yw3236
================
Yishan Wang
2018-11-19

Problem 1
=========

``` r
homicides_data = read.csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")
```

``` r
new_homicides_data = homicides_data %>%
  mutate(city_state = paste(city, state, sep = ", ")) %>%
  mutate(resolved = as.numeric(disposition == "Closed by arrest")) %>% #factor???
  filter(city_state != "Dallas, TX" & city_state != "Phoenix, AZ" & city_state != "Kansas City, MO") %>%
  filter(city_state != "Tulsa, AL") %>%
  mutate(victim_race = ifelse(victim_race == "White", "white", "non-white"),
         victim_race = fct_relevel(victim_race, "white"),
         victim_age = as.numeric(victim_age))
```

``` r
fit_logistic = new_homicides_data %>%
  filter(city_state == "Baltimore, MD") %>%
  glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 
```

``` r
fit_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         CI_lower = exp(estimate - qnorm(0.975) * std.error),
         CI_upper = exp(estimate + qnorm(0.975) * std.error)) %>%
  filter(term == "victim_racenon-white") %>%
  select(OR, CI_lower, CI_upper, p.value) %>% 
  knitr::kable(digits = 3)
```

|     OR|  CI\_lower|  CI\_upper|  p.value|
|------:|----------:|----------:|--------:|
|  0.453|      0.322|      0.637|        0|

``` r
glm_function = function(city_data){
  
  city_data %>%
    nest(-city_state) %>%  #nest first
    mutate(glm = purrr::map(data, ~glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())),
           tidied = purrr::map(glm, broom::tidy)) %>%  #apply test
    unnest(tidied, .drop = TRUE) %>%  #unnest
    mutate(OR = exp(estimate),
           CI_lower = exp(estimate - qnorm(0.975) * std.error),
           CI_upper = exp(estimate + qnorm(0.975) * std.error)) %>%
    filter(term == "victim_racenon-white") %>%
    select(city_state, OR, CI_lower, CI_upper, p.value) %>%
    data.frame()
  
}
```

``` r
multicity_glm = glm_function(new_homicides_data)

multicity_glm
```

    ##            city_state        OR   CI_lower  CI_upper      p.value
    ## 1     Albuquerque, NM 0.6860531 0.41769744 1.1268177 1.366591e-01
    ## 2         Atlanta, GA 0.7667500 0.44043049 1.3348431 3.477621e-01
    ## 3       Baltimore, MD 0.4525206 0.32162029 0.6366977 5.331248e-06
    ## 4     Baton Rouge, LA 0.6558545 0.30741032 1.3992540 2.752534e-01
    ## 5      Birmingham, AL 1.0471153 0.62269277 1.7608210 8.621679e-01
    ## 6          Boston, MA 0.1205147 0.04963250 0.2926265 2.940514e-06
    ## 7         Buffalo, NY 0.4474175 0.24550184 0.8154008 8.629589e-03
    ## 8       Charlotte, NC 0.5550724 0.32506541 0.9478259 3.106466e-02
    ## 9         Chicago, IL 0.5751690 0.44124894 0.7497341 4.316150e-05
    ## 10     Cincinnati, OH 0.3269424 0.18968348 0.5635248 5.703613e-05
    ## 11       Columbus, OH 0.8844860 0.65711787 1.1905254 4.181399e-01
    ## 12         Denver, CO 0.5942632 0.35308656 1.0001761 5.007753e-02
    ## 13        Detroit, MI 0.6609813 0.49580808 0.8811801 4.769658e-03
    ## 14         Durham, NC 1.1528002 0.46059312 2.8852976 7.612982e-01
    ## 15     Fort Worth, TX 0.8527376 0.56467218 1.2877586 4.487759e-01
    ## 16         Fresno, CA 0.4574375 0.23648135 0.8848439 2.015723e-02
    ## 17        Houston, TX 0.9207334 0.73858545 1.1478022 4.627698e-01
    ## 18   Indianapolis, IN 0.5162217 0.39044128 0.6825223 3.471773e-06
    ## 19   Jacksonville, FL 0.6805895 0.51929321 0.8919855 5.299920e-03
    ## 20      Las Vegas, NV 0.7883387 0.61333000 1.0132848 6.332233e-02
    ## 21     Long Beach, CA 0.8428440 0.41252831 1.7220296 6.390576e-01
    ## 22    Los Angeles, CA 0.7176698 0.52454234 0.9819036 3.806605e-02
    ## 23     Louisville, KY 0.4336608 0.28801137 0.6529661 6.302610e-05
    ## 24        Memphis, TN 0.8066744 0.54102411 1.2027626 2.918345e-01
    ## 25          Miami, FL 0.5768849 0.37923895 0.8775371 1.015962e-02
    ## 26      Milwaukee, wI 0.6598363 0.42186855 1.0320369 6.848733e-02
    ## 27    Minneapolis, MN 0.6665973 0.35468100 1.2528216 2.077369e-01
    ## 28      Nashville, TN 0.8919720 0.64835104 1.2271348 4.824362e-01
    ## 29    New Orleans, LA 0.5105893 0.32582023 0.8001390 3.359309e-03
    ## 30       New York, NY 0.5481259 0.28832333 1.0420316 6.660181e-02
    ## 31        Oakland, CA 0.2174194 0.10662218 0.4433524 2.700626e-05
    ## 32  Oklahoma City, OK 0.7114617 0.50344208 1.0054339 5.369942e-02
    ## 33          Omaha, NE 0.1795682 0.09934289 0.3245803 1.304811e-08
    ## 34   Philadelphia, PA 0.6615811 0.49973950 0.8758354 3.899466e-03
    ## 35     Pittsburgh, PA 0.2896680 0.16576229 0.5061919 1.357498e-05
    ## 36       Richmond, VA 0.4882646 0.18278443 1.3042815 1.527033e-01
    ## 37    San Antonio, TX 0.6983376 0.46861044 1.0406841 7.772517e-02
    ## 38     Sacramento, CA 0.7743855 0.44708001 1.3413099 3.616313e-01
    ## 39       Savannah, GA 0.6437600 0.31355787 1.3216921 2.301312e-01
    ## 40 San Bernardino, CA 0.9462056 0.42593920 2.1019550 8.919929e-01
    ## 41      San Diego, CA 0.4339041 0.26685765 0.7055177 7.615544e-04
    ## 42  San Francisco, CA 0.4577118 0.29010830 0.7221444 7.817084e-04
    ## 43      St. Louis, MO 0.6010156 0.42391476 0.8521048 4.255904e-03
    ## 44       Stockton, CA 0.3954507 0.20783139 0.7524428 4.705254e-03
    ## 45          Tampa, FL 1.1845998 0.61216751 2.2923083 6.149962e-01
    ## 46          Tulsa, OK 0.5857297 0.40218967 0.8530285 5.291572e-03
    ## 47     Washington, DC 0.5268148 0.26665598 1.0407935 6.505641e-02

``` r
multicity_glm %>%
  ggplot() +
  geom_point(aes(x = reorder(city_state, OR), y = OR)) +  #order cities by the value of estimates
  geom_errorbar(aes(x = reorder(city_state, OR), ymin = CI_lower, ymax = CI_upper, OR)) +  #add error bar
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = rel(1))) +
  labs(x = "City", y = "OR for Comparing Non-white Victims to White Victims (95% CI)")
```

![](p8105_hw6_yw3236_files/figure-markdown_github/unnamed-chunk-8-1.png)

Problem 2
=========

``` r
birthweight_data = read.csv("./data/birthweight.csv") %>%
  janitor::clean_names() %>%
  mutate(mrace = factor(mrace, levels = c("1", "2", "3", "4", "8")),
         malform = factor(malform, levels = c("0", "1")),
         frace = factor(frace, levels = c("1", "2", "3", "4", "8", "9")),
         babysex = factor(babysex, levels = c("1", "2")))

sapply(birthweight_data, function(x)sum(is.na(x)))
```

    ##  babysex    bhead  blength      bwt    delwt  fincome    frace  gaweeks 
    ##        0        0        0        0        0        0        0        0 
    ##  malform menarche  mheight   momage    mrace   parity  pnumlbw  pnumsga 
    ##        0        0        0        0        0        0        0        0 
    ##    ppbmi     ppwt   smoken   wtgain 
    ##        0        0        0        0

View(birthweight\_data)
